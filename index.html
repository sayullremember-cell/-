<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pink Gold Tree (Safe Mode)</title>
    
    <style>
        body { margin: 0; overflow: hidden; background-color: #050005; font-family: 'Times New Roman', serif; user-select: none; }
        
        /* Loading ç•Œé¢ */
        #loader { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: #1a001a; 
            z-index: 999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 1s; 
        }
        .spinner { 
            width: 50px; height: 50px; border: 3px solid rgba(255, 105, 180, 0.2); 
            border-top: 3px solid #ff69b4; border-radius: 50%; 
            animation: spin 1s infinite linear; 
        }
        /* æ”¹ä¸ªæ–°åå­—ï¼Œè®©ä½ ç¡®è®¤ä»£ç æ›´æ–°äº† */
        .loading-text { color: #ff69b4; margin-top: 20px; font-size: 14px; font-weight: bold; letter-spacing: 2px; }
        
        /* æ ‡é¢˜ */
        h1 { 
            position: absolute; top: 30px; width: 100%; text-align: center; 
            background: linear-gradient(to bottom, #fff, #ff69b4, #ffd700); -webkit-background-clip: text; color: transparent;
            font-size: 40px; text-shadow: 0 0 30px rgba(255, 105, 180, 0.8); z-index: 10; pointer-events: none;
        }

        /* è°ƒè¯•æ§åˆ¶å° (å¦‚æœå‡ºé”™ä¼šæ˜¾ç¤ºåœ¨å·¦ä¸Šè§’) */
        #debug-console {
            position: fixed; top: 0; left: 0; padding: 10px; color: red; font-size: 12px; z-index: 10000;
            background: rgba(0,0,0,0.8); display: none; max-width: 300px; word-wrap: break-word;
        }

        @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>

    <!-- 1. ä½¿ç”¨å›½å†…æœ€ç¨³çš„ Staticfile CDN åŠ è½½ Three.js -->
    <script src="https://cdn.staticfile.org/three.js/r128/three.min.js"></script>
    <!-- ç‰¹æ•ˆåº“ -->
    <script src="https://cdn.staticfile.org/three.js/r128/examples/js/shaders/CopyShader.js"></script>
    <script src="https://cdn.staticfile.org/three.js/r128/examples/js/shaders/LuminosityHighPassShader.js"></script>
    <script src="https://cdn.staticfile.org/three.js/r128/examples/js/postprocessing/EffectComposer.js"></script>
    <script src="https://cdn.staticfile.org/three.js/r128/examples/js/postprocessing/ShaderPass.js"></script>
    <script src="https://cdn.staticfile.org/three.js/r128/examples/js/postprocessing/RenderPass.js"></script>
    <script src="https://cdn.staticfile.org/three.js/r128/examples/js/postprocessing/UnrealBloomPass.js"></script>

</head>
<body>

    <div id="debug-console"></div>

    <div id="loader">
        <div class="spinner"></div>
        <div class="loading-text">VERSION: UNSTOPPABLE PINK ğŸŒ¸</div>
        <div style="color: #666; font-size: 10px; margin-top: 10px;">(Auto-skip in 3s if stuck)</div>
    </div>

    <h1>Merry Christmas</h1>

    <script>
        // === 1. å®‰å…¨é˜€æœºåˆ¶ (ä¿å‘½ä»£ç ) ===
        // å¦‚æœ 3 ç§’å loader è¿˜åœ¨ï¼Œå¼ºåˆ¶æŠŠå®ƒå…³æ‰ï¼Œå¹¶æ˜¾ç¤ºå¯èƒ½çš„åŸå› 
        setTimeout(function() {
            var loader = document.getElementById('loader');
            if (loader && loader.style.opacity !== '0') {
                loader.style.opacity = 0;
                setTimeout(() => loader.remove(), 1000);
                console.log("Force removed loader.");
            }
        }, 3000);

        // === 2. é”™è¯¯æ•æ‰ ===
        window.onerror = function(msg, url, line) {
            var consoleDiv = document.getElementById('debug-console');
            consoleDiv.style.display = 'block';
            consoleDiv.innerHTML += "âŒ Error: " + msg + "<br>";
        };

        // === 3. ä¸»ç¨‹åº ===
        window.onload = function() {
            initScene();
        };

        let scene, camera, renderer, composer, mainGroup;
        let particles = [];
        let time = 0;
        let mouseX = 0, mouseY = 0;

        function initScene() {
            // æ£€æŸ¥ Three.js æ˜¯å¦åŠ è½½
            if (typeof THREE === 'undefined') {
                document.getElementById('debug-console').style.display = 'block';
                document.getElementById('debug-console').innerHTML = "âŒ FATAL: Three.js failed to load from CDN.";
                return;
            }

            // 1. åœºæ™¯
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050005, 0.02);

            // 2. ç›¸æœº
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 50);

            // 3. æ¸²æŸ“å™¨
            renderer = new THREE.WebGLRenderer({ antialias: false });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
            renderer.toneMapping = THREE.ReinhardToneMapping;
            document.body.appendChild(renderer.domElement);

            // 4. ç¯å¢ƒè´´å›¾ (ç²‰é‡‘æ¸å˜)
            const canvas = document.createElement('canvas');
            canvas.width = 256; canvas.height = 256;
            const ctx = canvas.getContext('2d');
            const grd = ctx.createLinearGradient(0,0,0,256);
            grd.addColorStop(0, '#ffffff');
            grd.addColorStop(0.4, '#ff69b4'); 
            grd.addColorStop(0.7, '#ffd700');
            grd.addColorStop(1, '#100010');
            ctx.fillStyle = grd; ctx.fillRect(0,0,256,256);
            const envMap = new THREE.CanvasTexture(canvas);
            envMap.mapping = THREE.EquirectangularReflectionMapping;
            scene.environment = envMap;

            // 5. ç¯å…‰
            const ambient = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(ambient);
            const spotGold = new THREE.SpotLight(0xffd700, 2);
            spotGold.position.set(20, 50, 20);
            scene.add(spotGold);

            // 6. åˆ›å»ºæ ‘
            mainGroup = new THREE.Group();
            scene.add(mainGroup);
            createTree();

            // 7. è¾‰å…‰
            if (THREE.EffectComposer) {
                const renderPass = new THREE.RenderPass(scene, camera);
                const bloomPass = new THREE.UnrealBloomPass(new THREE.Vector2(window.innerWidth, window.innerHeight), 1.5, 0.4, 0.85);
                bloomPass.threshold = 0.15;
                bloomPass.strength = 1.6;
                bloomPass.radius = 0.8;
                composer = new THREE.EffectComposer(renderer);
                composer.addPass(renderPass);
                composer.addPass(bloomPass);
            }

            // 8. åŠ¨ç”»
            animate();
            
            // 9. äº¤äº’
            window.addEventListener('resize', onResize);
            window.addEventListener('mousemove', onMouseMove);

            // ä¸»åŠ¨ç§»é™¤ Loading
            const loader = document.getElementById('loader');
            loader.style.opacity = 0;
            setTimeout(() => loader.remove(), 1000);
        }

        function createTree() {
            // æè´¨ï¼šç²‰è‰²é’»çŸ³ & é‡‘è‰²
            const geo = new THREE.OctahedronGeometry(0.35);
            const matPink = new THREE.MeshStandardMaterial({
                color: 0xff1493, roughness: 0.05, metalness: 0.9, envMapIntensity: 1.5
            });
            const matGold = new THREE.MeshStandardMaterial({
                color: 0xffd700, roughness: 0.1, metalness: 1.0, envMapIntensity: 2.0
            });

            // æ ‘é¡¶æ˜Ÿ
            const topStar = new THREE.Mesh(new THREE.SphereGeometry(1.5), new THREE.MeshBasicMaterial({color:0xffd700}));
            topStar.position.y = 19;
            mainGroup.add(topStar);
            
            // æ ‘é¡¶å‘å…‰
            const topLight = new THREE.PointLight(0xffd700, 2, 20);
            topLight.position.y = 19;
            mainGroup.add(topLight);

            for(let i=0; i<1800; i++) {
                const isGold = Math.random() > 0.8;
                const mesh = new THREE.Mesh(geo, isGold ? matGold : matPink);
                
                const t = i / 1800;
                const angle = t * 50 * Math.PI;
                const h = t * 36 - 18;
                const r = 13 * (1 - Math.pow(t, 0.8));

                const x = Math.cos(angle) * r;
                const z = Math.sin(angle) * r;

                mesh.position.set(x, h, z);
                mesh.rotation.set(Math.random()*3, Math.random()*3, 0);

                mesh.userData = {
                    initialY: h,
                    blinkOffset: Math.random() * 100,
                    speed: Math.random() * 0.02 + 0.01
                };
                
                mainGroup.add(mesh);
                particles.push(mesh);
            }
        }

        function animate() {
            requestAnimationFrame(animate);
            time += 0.01;

            mainGroup.rotation.y += 0.002;
            mainGroup.rotation.y += (mouseX * 0.5 - mainGroup.rotation.y) * 0.05;
            mainGroup.rotation.x += (mouseY * 0.3 - mainGroup.rotation.x) * 0.05;

            particles.forEach(p => {
                p.rotation.x += p.userData.speed;
                p.rotation.y += p.userData.speed;
                // å‘¼å¸é—ªçƒ
                const s = 1 + Math.sin(time * 3 + p.userData.blinkOffset) * 0.3;
                p.scale.setScalar(s);
            });

            if(composer) composer.render();
            else renderer.render(scene, camera);
        }

        function onMouseMove(e) {
            mouseX = (e.clientX / window.innerWidth - 0.5) * 2;
            mouseY = (e.clientY / window.innerHeight - 0.5) * 1;
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            if(composer) composer.setSize(window.innerWidth, window.innerHeight);
        }
    </script>
</body>
</html>
